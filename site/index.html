<html>
    <head>
        <title>Chat Bot</title>
        <style>
            #chat_output {
                resize: none;
                width: 60%;
                height: 60%;
            }
            #chat_input {
                width: 30%;
                height: 20%;
            }
        </style>
        <script type="text/javascript">
            // Initialize connection to the backend server
            var SOCKET = new WebSocket('ws://localhost:8000');

            // variable is only true if connected via websocket to the backend server
            var socket_connected = false;

            SOCKET.addEventListener('open', function (event) {
                socket_connected = true;
            });

            SOCKET.addEventListener('close', function (event) {
                socket_connected = false;
            });

            // when message is received from the backend server, print it to the chat output
            SOCKET.onmessage = function (event) {
                document.getElementById('chat_output').value += event.data + '\n';
                
            };

            // when the user submits the chat input, send the message to the backend server
            function sendMessage(event) {
                
                var message = document.getElementById('chat_input').value;
                if (message != '') {
                    chat_input.value = '';
                    if (socket_connected) {
                        SOCKET.send(message);
                    } else {
                        alert('You are not connected to the backend server. Please refresh the page. Or check that the backend server is running and all is configured properly.');
                    }
                } else {
                    alert('Please enter a message.');
                }
            }
            /*function sendMessage() {
                var message = document.getElementById("chat_input").value;

                if (message == "") {
                    alert("Please enter a message");
                }
                else {
                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            document.getElementById("chat_output").value += (this.responseText + "\n");
                        }
                    }
                    // Todo: use jinja2 to render the html, putting in an environment variable for the hostname
                    xmlhttp.open("GET", "http://localhost:8000/send_message?message=" + message, true);
                    xmlhttp.send();
                    document.getElementById("chat_input").value = "";
                }
            }*/

        </script>
    </head>
    <body>
        <div>
            <textarea id="chat_output" readonly></textarea>
        </div>
        <div>
            <textarea id="chat_input" placeholder="Type your message here..."></textarea>
        </div>
        <div>
            <button id="chat_button" onclick="sendMessage()">Send</button>
        </div>
    </body>
</html>